{
    "Parameters": {
        "Project": {
            "Type": "String",
            "Default": "SCCA-Demo",
            "Description": "Project name to use for tagging"
        },
        "VdssVpcCidr": {
            "Type": "String",
            "Default": "10.0.0.0/16",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "Must be a valid IP CIDR range of the form x.x.x.x/x.",
            "Description": "CIDR Block for the VDSS VPC",
            "MaxLength": 18,
            "MinLength": 9
        },
        "AppVpcCidr": {
            "Type": "String",
            "Default": "10.1.0.0/16",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "Must be a valid IP CIDR range of the form x.x.x.x/x.",
            "Description": "CIDR Block for the App VPC",
            "MaxLength": 18,
            "MinLength": 9
        },
        "FargateVpcCidr": {
            "Type": "String",
            "Default": "10.2.0.0/16",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
            "ConstraintDescription": "Must be a valid IP CIDR range of the form x.x.x.x/x.",
            "Description": "CIDR Block for the App VPC",
            "MaxLength": 18,
            "MinLength": 9
        },
        "TransitGatewayStackName": {
            "Type": "String",
            "Default": "SccaTgwStack",
            "Description": "Transit Gateway Stack Name"
        }
    },
    "Resources": {
        "VdssVpc": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": {
                    "Ref": "VdssVpcCidr"
                },
                "EnableDnsHostnames": true,
                "EnableDnsSupport": true,
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-vpc"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssVpc"
            }
        },
        "VdssIgw": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-igw"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssIgw"
            }
        },
        "VdssIgwAttachment": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "InternetGatewayId": {
                    "Ref": "VdssIgw"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssIgwAttachment"
            }
        },
        "VdssOutsideRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-outside-rt"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssOutsideRouteTable"
            }
        },
        "VdssOutsideRouteTableIgwRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssOutsideRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "VdssIgw"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssOutsideRouteTableIgwRoute"
            }
        },
        "VdssOutsideSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "CidrBlock": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::Cidr": [
                                {
                                    "Ref": "VdssVpcCidr"
                                },
                                16,
                                "8"
                            ]
                        }
                    ]
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "MapPublicIpOnLaunch": false,
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-outside-subnet"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssOutsideSubnetA"
            }
        },
        "VdssOutsideSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssOutsideRouteTable"
                },
                "SubnetId": {
                    "Ref": "VdssOutsideSubnet"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssOutsideSubnetRouteTableAssociation"
            }
        },
        "NatGatewayEipA": {
            "Type": "AWS::EC2::EIP",
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rNatGatewayEipA"
            }
        },
        "NatGateway": {
            "Type": "AWS::EC2::NatGateway",
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "NatGatewayEipA",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "VdssOutsideSubnet"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-nat-gw-a"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rNatGateway"
            }
        },
        "VdssInternalRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-internal-rt"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssInternalRouteTable"
            }
        },
        "VdssInternalRouteTableNatGwRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssInternalRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "NatGateway"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz1RouteTableNatGwRoute"
            }
        },
        "VdssDmz1Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "CidrBlock": {
                    "Fn::Select": [
                        1,
                        {
                            "Fn::Cidr": [
                                {
                                    "Ref": "VdssVpcCidr"
                                },
                                16,
                                "8"
                            ]
                        }
                    ]
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-dmz-1-subnet"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz1Subnet"
            }
        },
        "VdssDmz1SubnetRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-dmz1subnet-rt"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz1SubnetRouteTable"
            }
        },
        "VdssDmz1RouteTableNatGwRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssDmz1SubnetRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "NatGateway"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz1RouteTableNatGwRoute"
            }
        },
        "VdssDmz1SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssDmz1SubnetRouteTable"
                },
                "SubnetId": {
                    "Ref": "VdssDmz1Subnet"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz1SubnetRouteTableAssociation"
            }
        },
        "VdssDmz2Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "CidrBlock": {
                    "Fn::Select": [
                        2,
                        {
                            "Fn::Cidr": [
                                {
                                    "Ref": "VdssVpcCidr"
                                },
                                16,
                                "8"
                            ]
                        }
                    ]
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-dmz-2-subnet"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz2Subnet"
            }
        },
        "VdssDmz2SubnetRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-dmz2subnet-rt"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz2SubnetRouteTable"
            }
        },
        "VdssDmz2RouteTableNatGwRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssDmz2SubnetRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "NatGateway"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz2RouteTableNatGwRoute"
            }
        },
        "VdssDmz2SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssDmz2SubnetRouteTable"
                },
                "SubnetId": {
                    "Ref": "VdssDmz2Subnet"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssDmz2SubnetRouteTableAssociation"
            }
        },
        "VdssInsideSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "CidrBlock": {
                    "Fn::Select": [
                        3,
                        {
                            "Fn::Cidr": [
                                {
                                    "Ref": "VdssVpcCidr"
                                },
                                16,
                                "8"
                            ]
                        }
                    ]
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-inside-subnet"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssInsideSubnet"
            }
        },
        "VdssInsideSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssInternalRouteTable"
                },
                "SubnetId": {
                    "Ref": "VdssInsideSubnet"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssInsideSubnetRouteTableAssociation"
            }
        },
        "VdssManagementRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-mgmt-rt"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssManagementRouteTable"
            }
        },
        "VdssManagementRouteTableIgwRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssManagementRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "VdssIgw"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssOutsideRouteTableIgwRoute"
            }
        },
        "VdssManagementRouteTableAppVpcRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssManagementRouteTable"
                },
                "DestinationCidrBlock": { "Ref" : "AppVpcCidr" },
                "GatewayId": {
                    "Ref": "VdssIgw"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssManagementRouteTableAppVpcRoute"
            }
        },
        "VdssManagementRouteTableFargateVpcRoute": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssManagementRouteTable"
                },
                "DestinationCidrBlock": { "Ref" : "FargateVpcCidr" },
                "GatewayId": {
                    "Ref": "VdssIgw"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssManagementRouteTableFargateVpcRoute"
            }
        },
        "VdssManagementSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "CidrBlock": {
                    "Fn::Select": [
                        4,
                        {
                            "Fn::Cidr": [
                                {
                                    "Ref": "VdssVpcCidr"
                                },
                                16,
                                "8"
                            ]
                        }
                    ]
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        0,
                        {
                            "Fn::GetAZs": ""
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-mgmt-subnet"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssManagementSubnet"
            }
        },
        "VdssManagementSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "VdssManagementRouteTable"
                },
                "SubnetId": {
                    "Ref": "VdssManagementSubnet"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rVdssManagementSubnetRouteTableAssociation"
            }
        },
        "TransitGatewayAttachement": {
            "Type": "AWS::EC2::TransitGatewayAttachment",
            "Properties": {
                "SubnetIds": [
                    {
                        "Ref": "VdssInsideSubnet"
                    }
                ],
                "TransitGatewayId": {
                    "Fn::ImportValue": {
                        "Fn::Join": [
                            "",
                            [
                                {
                                    "Ref": "TransitGatewayStackName"
                                },
                                "-SccaTgwId"
                            ]
                        ]
                    }
                },
                "VpcId": {
                    "Ref": "VdssVpc"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "vdss-tgw-attachment"
                    },
                    {
                        "Key": "Project",
                        "Value": {
                            "Ref": "Project"
                        }
                    }
                ]
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rTransitGatewayAttachement"
            }
        },
        "TransitGatewayRouteTableAssociation": {
            "Type": "AWS::EC2::TransitGatewayRouteTableAssociation",
            "Properties": {
                "TransitGatewayAttachmentId": {
                    "Ref": "TransitGatewayAttachement"
                },
                "TransitGatewayRouteTableId": {
                    "Fn::ImportValue": {
                        "Fn::Join": [
                            "",
                            [
                                {
                                    "Ref": "TransitGatewayStackName"
                                },
                                "-SccaMainTgwRouteTableId"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rTransitGatewayRouteTableAssociation"
            }
        },
        "TransitGatewayRouteTablePropagation": {
            "Type": "AWS::EC2::TransitGatewayRouteTablePropagation",
            "Properties": {
                "TransitGatewayAttachmentId": {
                    "Ref": "TransitGatewayAttachement"
                },
                "TransitGatewayRouteTableId": {
                    "Fn::ImportValue": {
                        "Fn::Join": [
                            "",
                            [
                                {
                                    "Ref": "TransitGatewayStackName"
                                },
                                "-SccaMainTgwRouteTableId"
                            ]
                        ]
                    }
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rTransitGatewayRouteTablePropagation"
            }
        },
        "MainTransitGatewayRouteDefault": {
            "Type": "AWS::EC2::TransitGatewayRoute",
            "Properties": {
                "TransitGatewayRouteTableId": {
                    "Fn::ImportValue": {
                        "Fn::Join": [
                            "",
                            [
                                {
                                    "Ref": "TransitGatewayStackName"
                                },
                                "-SccaMainTgwRouteTableId"
                            ]
                        ]
                    }
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "TransitGatewayAttachmentId": {
                    "Ref": "TransitGatewayAttachement"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rMainTransitGatewayRouteDefault"
            }
        },
        "MainTransitGatewayRouteVdss": {
            "Type": "AWS::EC2::TransitGatewayRoute",
            "Properties": {
                "TransitGatewayRouteTableId": {
                    "Fn::ImportValue": {
                        "Fn::Join": [
                            "",
                            [
                                {
                                    "Ref": "TransitGatewayStackName"
                                },
                                "-SccaMainTgwRouteTableId"
                            ]
                        ]
                    }
                },
                "DestinationCidrBlock": {
                    "Ref": "VdssVpcCidr"
                },
                "TransitGatewayAttachmentId": {
                    "Ref": "TransitGatewayAttachement"
                }
            },
            "Metadata": {
                "aws:cdk:path": "SccaVdssStack/rMainTransitGatewayRouteVdss"
            }
        },
        "InternalRoute10" : {
            "Type" : "AWS::EC2::Route",
            "DependsOn" : "TransitGatewayAttachement",
            "Properties" : {
              "RouteTableId" : { "Ref" : "VdssInternalRouteTable" },
              "DestinationCidrBlock" : "10.0.0.0/8",
              "TransitGatewayId": {
               "Fn::ImportValue": {
                   "Fn::Join": [
                     "",
                     [
                         {
                             "Ref": "TransitGatewayStackName"
                         },
                         "-SccaTgwId"
                     ]
                   ]
                 }
             }
         }
        },
        "InternalRoute172" : {
            "Type" : "AWS::EC2::Route",
            "DependsOn" : "TransitGatewayAttachement",
            "Properties" : {
              "RouteTableId" : { "Ref" : "VdssInternalRouteTable" },
              "DestinationCidrBlock" : "172.16.0.0/12",
              "TransitGatewayId": {
               "Fn::ImportValue": {
                   "Fn::Join": [
                     "",
                     [
                         {
                             "Ref": "TransitGatewayStackName"
                         },
                         "-SccaTgwId"
                     ]
                   ]
                 }
             }
         }
        },
        "InternalRoute192" : {
            "Type" : "AWS::EC2::Route",
            "DependsOn" : "TransitGatewayAttachement",
            "Properties" : {
              "RouteTableId" : { "Ref" : "VdssInternalRouteTable" },
              "DestinationCidrBlock" : "192.168.0.0/16",
              "TransitGatewayId": {
               "Fn::ImportValue": {
                   "Fn::Join": [
                     "",
                     [
                         {
                             "Ref": "TransitGatewayStackName"
                         },
                         "-SccaTgwId"
                     ]
                   ]
                 }
             }
         }
        },
        "InternalAppVPC" : {
            "Type" : "AWS::EC2::Route",
            "DependsOn" : "TransitGatewayAttachement",
            "Properties" : {
              "RouteTableId" : { "Ref" : "VdssInternalRouteTable" },
              "DestinationCidrBlock" : { "Ref" : "AppVpcCidr" },
              "TransitGatewayId": {
               "Fn::ImportValue": {
                   "Fn::Join": [
                     "",
                     [
                         {
                             "Ref": "TransitGatewayStackName"
                         },
                         "-SccaTgwId"
                     ]
                   ]
                 }
             }
         }
        },
        "InternalFargateVPC" : {
            "Type" : "AWS::EC2::Route",
            "DependsOn" : "TransitGatewayAttachement",
            "Properties" : {
              "RouteTableId" : { "Ref" : "VdssInternalRouteTable" },
              "DestinationCidrBlock" : { "Ref" : "FargateVpcCidr" },
              "TransitGatewayId": {
               "Fn::ImportValue": {
                   "Fn::Join": [
                     "",
                     [
                         {
                             "Ref": "TransitGatewayStackName"
                         },
                         "-SccaTgwId"
                     ]
                   ]
                 }
             }
         }
        }
    },
    "Outputs": {
        "StackName": {
            "Value": {
                "Ref": "AWS::StackName"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-StackName"
                        ]
                    ]
                }
            }
        },
        "OutsideSubnetIpRange": {
            "Value": {
                "Fn::Select": [
                    0,
                    {
                        "Fn::Cidr": [
                            {
                                "Ref": "VdssVpcCidr"
                            },
                            16,
                            "8"
                        ]
                    }
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-OutsideSubnetIpRange"
                        ]
                    ]
                }
            }
        },
        "Dmz1SubnetIpRange": {
            "Value": {
                "Fn::Select": [
                    1,
                    {
                        "Fn::Cidr": [
                            {
                                "Ref": "VdssVpcCidr"
                            },
                            16,
                            "8"
                        ]
                    }
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-Dmz1SubnetIpRange"
                        ]
                    ]
                }
            }
        },
        "Dmz2SubnetIpRange": {
            "Value": {
                "Fn::Select": [
                    2,
                    {
                        "Fn::Cidr": [
                            {
                                "Ref": "VdssVpcCidr"
                            },
                            16,
                            "8"
                        ]
                    }
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-Dmz2SubnetIpRange"
                        ]
                    ]
                }
            }
        },
        "InsideSubnetIpRange": {
            "Value": {
                "Fn::Select": [
                    3,
                    {
                        "Fn::Cidr": [
                            {
                                "Ref": "VdssVpcCidr"
                            },
                            16,
                            "8"
                        ]
                    }
                ]
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-InsideSubnetIpRange"
                        ]
                    ]
                }
            }
        },
        "InsideSubnetGWIP": {
            "Value": {
                "Fn::Join": [
                    ".",
                    [
                        {"Fn::Select" : [ 0, { "Fn::Split": [ ".", { "Fn::Select" : [ 3, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 1, { "Fn::Split": [ ".", { "Fn::Select" : [ 3, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 2, { "Fn::Split": [ ".", { "Fn::Select" : [ 3, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        "1"
                    ]
                ]
             },
             "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-InsideSubnetGWIP"
                        ]
                    ]
                }
            }
        },
        "InternalTierVIP": {
            "Value": {
                "Fn::Join": [
                    ".",
                    [
                        {"Fn::Select" : [ 0, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 1, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 2, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        "50"
                    ]
                ]
             },
             "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-InternalTierVIP"
                        ]
                    ]
                }
            }
        },
        "ExternalTierVIP": {
            "Value": {
                "Fn::Join": [
                    ".",
                    [
                        {"Fn::Select" : [ 0, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 1, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 2, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        "50"
                    ]
                ]
             },
             "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-ExternalTierVIP"
                        ]
                    ]
                }
            }
        },
        "extSelfIPInternalTier": {
            "Value": {
                "Fn::Join": [
                    ".",
                    [
                        {"Fn::Select" : [ 0, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 1, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 2, { "Fn::Split": [ ".", { "Fn::Select" : [ 2, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        "10"
                    ]
                ]
             },
             "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-extSelfIPInternalTier"
                        ]
                    ]
                }
            }
        },
        "extSelfIPExternalTier": {
            "Value": {
                "Fn::Join": [
                    ".",
                    [
                        {"Fn::Select" : [ 0, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 1, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        {"Fn::Select" : [ 2, { "Fn::Split": [ ".", { "Fn::Select" : [ 0, { "Fn::Cidr": [ { "Ref": "VdssVpcCidr" }, 16, "8" ] } ] } ] } ]},
                        "10"
                    ]
                ]
             },
             "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-extSelfIPExternalTier"
                        ]
                    ]
                }
            }
        },
        "VdssVpcId": {
            "Value": {
                "Ref": "VdssVpc"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssVpcId"
                        ]
                    ]
                }
            }
        },
        "VdssOutsideSubnetId": {
            "Value": {
                "Ref": "VdssOutsideSubnet"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssOutsideSubnetId"
                        ]
                    ]
                }
            }
        },
        "VdssDmz1SubnetId": {
            "Value": {
                "Ref": "VdssDmz1Subnet"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssDmz1SubnetId"
                        ]
                    ]
                }
            }
        },
        "VdssDmz2SubnetId": {
            "Value": {
                "Ref": "VdssDmz2Subnet"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssDmz2SubnetId"
                        ]
                    ]
                }
            }
        },
        "VdssInsideSubnetId": {
            "Value": {
                "Ref": "VdssInsideSubnet"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssInsideSubnetId"
                        ]
                    ]
                }
            }
        },
        "VdssManagementSubnetId": {
            "Value": {
                "Ref": "VdssManagementSubnet"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssManagementSubnetId"
                        ]
                    ]
                }
            }
        },
        "VdssOutsideRouteTable": {
            "Value": {
                "Ref": "VdssOutsideRouteTable"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssOutsideRouteTable"
                        ]
                    ]
                }
            }
        },
        "VdssDmz1SubnetRouteTable": {
            "Value": {
                "Ref": "VdssDmz1SubnetRouteTable"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssDmz1SubnetRouteTable"
                        ]
                    ]
                }
            }
        },
        "VdssDmz2SubnetRouteTable": {
            "Value": {
                "Ref": "VdssDmz2SubnetRouteTable"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssDmz2SubnetRouteTable"
                        ]
                    ]
                }
            }
        },
        "VdssInternalRouteTable": {
            "Value": {
                "Ref": "VdssInternalRouteTable"
            },
            "Export": {
                "Name": {
                    "Fn::Join": [
                        "",
                        [
                            {
                                "Ref": "AWS::StackName"
                            },
                            "-VdssInternalRouteTable"
                        ]
                    ]
                }
            }
        }
    }
}
